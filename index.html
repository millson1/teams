<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Microsoft Teams Installer (Alle Ringe)</title>
  <style>
    :root {
      --border:#e6e6e6;
      --bg:#ffffff;
      --muted:#666;
      --pill:#f4f4f4;
    }
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      margin: 0;
      background: #fafafa;
      line-height: 1.4;
    }
    .wrap {
      max-width: 920px;
      margin: 0 auto;
      padding: 28px 16px 36px;
      text-align: center;
    }
    h1 { margin: 0 0 8px; font-size: 26px; }
    .subtitle { color: var(--muted); margin: 0 0 18px; }

    .controls {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
      align-items: center;
      margin: 10px 0 18px;
    }
    select, button {
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: var(--bg);
      font-size: 14px;
    }
    button { cursor: pointer; }
    .status {
      color: var(--muted);
      font-size: 12px;
      margin-top: 6px;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 14px;
      text-align: left;
      margin-top: 12px;
    }
    .card {
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 16px;
      box-shadow: 0 1px 2px rgba(0,0,0,.04);
    }
    .title {
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap: 10px;
      margin-bottom: 10px;
    }
    .title b { font-size: 16px; }
    .pill {
      font-size: 12px;
      padding: 3px 10px;
      border-radius: 999px;
      background: var(--pill);
      border: 1px solid var(--border);
      white-space: nowrap;
    }

    .row { margin: 8px 0; }
    .label { color: var(--muted); display:inline-block; min-width: 90px; }
    code {
      background: var(--pill);
      border: 1px solid var(--border);
      padding: 2px 8px;
      border-radius: 10px;
      font-size: 13px;
    }
    a { word-break: break-all; }

    .actions {
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 12px;
    }
    .actions button {
      flex: 1 1 140px;
      padding: 12px 12px;
      border-radius: 14px;
      font-weight: 600;
    }

    .hint {
      margin-top: 18px;
      font-size: 12px;
      color: var(--muted);
    }

    .error {
      display:none;
      text-align:left;
      margin: 14px auto 0;
      max-width: 920px;
      background:#fff3f3;
      border:1px solid #ffd1d1;
      padding: 12px 14px;
      border-radius: 14px;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Microsoft Teams neu installieren</h1>
    <p class="subtitle">Hier findest du die aktuellen Installer-Links. Standard: <b>Regulär (FÜR BENUTZER)</b>.</p>

    <div class="controls">
      <label>
        Ansicht:
        <select id="filter">
          <option value="regular" selected>Regulär (FÜR BENUTZER)</option>
          <option value="all">Alle Ringe (Canary, Preview, Dev …)</option>
        </select>
      </label>
      <button id="refresh">Aktualisieren</button>
    </div>

    <div class="status" id="status">Lade…</div>
    <div id="err" class="error"></div>

    <div id="grid" class="grid"></div>

    <div class="hint">
      Quelle: defconfig2 (ItzLevvie/MicrosoftTeams-msinternal). Die Seite lädt die Daten beim Öffnen und beim Klick auf „Aktualisieren“ neu.
    </div>
  </div>

<script>
(() => {
  const RAW_BASE =
    "https://raw.githubusercontent.com/ItzLevvie/MicrosoftTeams-msinternal/master/defconfig2";

  // Cache-Buster: hilft gegen zwischengespeicherte RAW-Antworten
  const rawUrl = () => RAW_BASE + "?t=" + Math.floor(Date.now() / 60000);

  const HEADING_TO_LABEL = [
    { key: "URLs for the latest Canary (R0) build of Microsoft Teams", label: "Canary (R0)" },
    { key: "URLs for the latest Canary Slimcore (R0s) build of Microsoft Teams", label: "Canary Slimcore (R0s)" },

    { key: "URLs for the latest Teams (R1) build of Microsoft Teams", label: "Regulär (FÜR BENUTZER)" },

    { key: "URLs for the latest IT Admins Preview (R1.5 or BETA) build of Microsoft Teams", label: "IT Admins Preview (R1.5 / BETA)" },
    { key: "URLs for the latest Developers Partners Preview (R1.6 or DP) build of Microsoft Teams", label: "Developer/Partner Preview (R1.6 / DP)" },
    { key: "URLs for the latest Microsoft Dogfood (R2 or DF) build of Microsoft Teams", label: "Dogfood (R2 / DF)" },

    { key: "URLs for the latest TAP/Beta Users (R3 or TAP) build of Microsoft Teams", label: "TAP/Beta Users (R3 / TAP)" },
    { key: "URLs for the latest Early Access (R3.6 or EA) build of Microsoft Teams", label: "Early Access (R3.6 / EA)" },
    { key: "URLs for the latest Microsoft Outer Ring (R3.9 or MS) build of Microsoft Teams", label: "Outer Ring (R3.9 / MS)" },

    { key: "URLs for the latest Public (R4) build of Microsoft Teams", label: "Public (R4)" },
    { key: "URLs for the latest Public GCC (R4) build of Microsoft Teams", label: "Public GCC (R4)" },
    { key: "URLs for the latest Public GCC High (R4) build of Microsoft Teams", label: "Public GCC High (R4)" },
    { key: "URLs for the latest Public DoD (R4) build of Microsoft Teams", label: "Public DoD (R4)" },
    { key: "URLs for the latest Public Gallatin (R4) build of Microsoft Teams", label: "Public Gallatin (R4)" },
  ];

  // Beispiel:
  // 26037.500.4358.2440 (win-x64) - published on Friday, February 6, 2026 at 8:18 AM with 249 MB: https://...
  const WINX64_RE = /(\d{5}\.\d+\.\d+\.\d+)\s+\(win-x64\)\s+-\s+published on\s+(.+?)\s+with\s+(.+?):\s+(https?:\/\/\S+)/i;

  const el = (id) => document.getElementById(id);
  const grid = el("grid");
  const status = el("status");
  const errBox = el("err");
  const filter = el("filter");

  function showError(msg) {
    errBox.style.display = "block";
    errBox.textContent = msg;
  }
  function clearError() {
    errBox.style.display = "none";
    errBox.textContent = "";
  }

  function cardHtml(item) {
    const esc = (s) => (s || "").replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;");
    const badge = item.kind === "regular" ? "Standard" : "Ring";

    return `
      <div class="card" data-kind="${item.kind}">
        <div class="title">
          <b>${esc(item.label)}</b>
          <span class="pill">${esc(badge)}</span>
        </div>

        <div class="row"><span class="label">Version</span> <code>${esc(item.version)}</code></div>
        <div class="row"><span class="label">Release</span> ${esc(item.released)}</div>
        <div class="row"><span class="label">Grösse</span> ${esc(item.size)}</div>
        <div class="row"><span class="label">Windows</span> <a href="${esc(item.url)}">${esc(item.url)}</a></div>

        <div class="actions">
          <button class="copy" data-url="${esc(item.url)}">Link kopieren</button>
          <button class="open" data-url="${esc(item.url)}">Installer öffnen</button>
        </div>
      </div>
    `;
  }

  function applyFilter() {
    const mode = filter.value; // "regular" oder "all"
    grid.querySelectorAll(".card").forEach(card => {
      const kind = card.getAttribute("data-kind");
      const show = (mode === "all") || (mode === "regular" && kind === "regular");
      card.style.display = show ? "" : "none";
    });
  }

  function wireButtons() {
    grid.querySelectorAll("button.copy").forEach(btn => {
      btn.addEventListener("click", async () => {
        const url = btn.getAttribute("data-url");
        try {
          await navigator.clipboard.writeText(url);
          const old = btn.textContent;
          btn.textContent = "Kopiert!";
          setTimeout(() => (btn.textContent = old), 900);
        } catch {
          alert("Kopieren fehlgeschlagen. Bitte den Link manuell markieren und kopieren.");
        }
      });
    });

    grid.querySelectorAll("button.open").forEach(btn => {
      btn.addEventListener("click", () => {
        window.location.href = btn.getAttribute("data-url");
      });
    });
  }

  function parse(text) {
    const blocks = [];
    for (const h of HEADING_TO_LABEL) {
      const idx = text.indexOf(h.key + ":");
      if (idx === -1) continue;

      const rest = text.slice(idx);
      const nextSep = rest.indexOf("————————————————");
      const blockText = nextSep !== -1 ? rest.slice(0, nextSep) : rest;

      blocks.push({ label: h.label, raw: blockText });
    }

    const items = [];
    for (const b of blocks) {
      // Fokus: “Teams 2.1 — Microsoft Teams” (Work/School) win-x64
      const teams21Idx = b.raw.indexOf("Teams 2.1 — Microsoft Teams:");
      const slice = teams21Idx !== -1 ? b.raw.slice(teams21Idx) : b.raw;

      const m = slice.match(WINX64_RE);
      if (!m) continue;

      items.push({
        label: b.label,
        kind: b.label.startsWith("Regulär") ? "regular" : "other",
        version: m[1],
        released: m[2],
        size: m[3],
        url: m[4]
      });
    }

    // Standard zuerst
    items.sort((a, b) => (a.kind === "regular" ? -1 : 1) - (b.kind === "regular" ? -1 : 1));
    return items;
  }

  async function load() {
    clearError();
    status.textContent = "Lade…";
    grid.innerHTML = "";

    try {
      const res = await fetch(rawUrl(), { cache: "no-store" });
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      const text = await res.text();

      const items = parse(text);
      if (!items.length) throw new Error("Keine Daten gefunden (Format hat sich evtl. geändert).");

      grid.innerHTML = items.map(cardHtml).join("");
      wireButtons();
      applyFilter();

      status.textContent = "Aktualisiert: " + new Date().toLocaleString("de-CH");
    } catch (e) {
      console.error(e);
      status.textContent = "Fehler";
      showError(
        "Konnte die Installer-Liste nicht laden.\n\n" +
        "Mögliche Gründe:\n" +
        "- GitHub RAW ist im Netzwerk blockiert\n" +
        "- temporäres Netzwerkproblem\n" +
        "- defconfig2 hat sein Format geändert"
      );
    }
  }

  el("refresh").addEventListener("click", load);
  filter.addEventListener("change", applyFilter);

  load();
})();
</script>
</body>
</html>
